<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ LLM Rover Control Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --border: #475569;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(at 40% 20%, hsla(228,62%,59%,0.15) 0px, transparent 50%),
                radial-gradient(at 80% 0%, hsla(189,68%,75%,0.15) 0px, transparent 50%),
                radial-gradient(at 0% 50%, hsla(355,100%,93%,0.1) 0px, transparent 50%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: var(--gradient);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            border: 1px solid var(--border);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'Courier New', monospace;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .quick-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .control-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 200px;
            margin: 0 auto;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .status-panel {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid var(--border);
        }

        .output {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }

        .status {
            margin-top: 15px;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 500;
        }

        .status.success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status.error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
            border: 1px solid var(--error);
        }

        .status.warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--error);
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: var(--success);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-secondary);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(37, 99, 235, 0.5);
        }

        .preset-commands {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .preset-btn {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
        }

        .preset-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .debug-panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .quick-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ LLM Rover Control Center</h1>
            <p>AI-Powered 2WD Rover with LED Control via Azure IoT</p>
        </div>

        <div class="main-grid">
            <!-- Natural Language Control -->
            <div class="card">
                <h2 class="card-title">üó£Ô∏è Natural Language Control</h2>
                
                <div class="form-group">
                    <label for="user-prompt">Tell your rover what to do:</label>
                    <textarea id="user-prompt" placeholder="Examples:&#10;‚Ä¢ Move forward at 75% speed for 3 seconds&#10;‚Ä¢ Turn left slowly for 2 seconds&#10;‚Ä¢ Blink LED 5 times quickly&#10;‚Ä¢ Send SOS in morse code&#10;‚Ä¢ Motor 1 forward 50%, motor 2 backward 100%">move forward at 75% speed for 3 seconds</textarea>
                </div>

                <div class="preset-commands">
                    <div class="preset-btn" onclick="setPrompt('move forward at 75% speed for 3 seconds')">Forward</div>
                    <div class="preset-btn" onclick="setPrompt('move backward at 50% speed for 2 seconds')">Backward</div>
                    <div class="preset-btn" onclick="setPrompt('turn left at 60% speed for 1.5 seconds')">Turn Left</div>
                    <div class="preset-btn" onclick="setPrompt('turn right at 60% speed for 1.5 seconds')">Turn Right</div>
                    <div class="preset-btn" onclick="setPrompt('stop all motors')">Stop</div>
                    <div class="preset-btn" onclick="setPrompt('blink LED 5 times with 0.5 second intervals')">Quick Blink</div>
                    <div class="preset-btn" onclick="setPrompt('send SOS in morse code')">SOS Morse</div>
                    <div class="preset-btn" onclick="setPrompt('motor 1 forward 70%, motor 2 backward 70% for 2 seconds')">Spin Turn</div>
                </div>

                <button class="btn btn-success" id="send-command" style="width: 100%; margin-top: 20px;">
                    üöÄ Send Command to Rover
                </button>
            </div>

            <!-- Manual Control Panel -->
            <div class="card">
                <h2 class="card-title">‚öôÔ∏è Manual Control Panel</h2>
                
                <div class="connection-status">
                    <div class="status-dot" id="connection-dot"></div>
                    <span id="connection-text">Disconnected</span>
                </div>

                <!-- Directional Control Pad -->
                <div style="text-align: center; margin-bottom: 20px;">
                    <p style="margin-bottom: 15px; color: var(--text-secondary);">Directional Control</p>
                    <div class="control-pad">
                        <div></div>
                        <button class="control-btn" onclick="quickMove('forward')" title="Forward">‚Üë</button>
                        <div></div>
                        <button class="control-btn" onclick="quickMove('left')" title="Turn Left">‚Üê</button>
                        <button class="control-btn" onclick="quickMove('stop')" title="Stop">‚èπ</button>
                        <button class="control-btn" onclick="quickMove('right')" title="Turn Right">‚Üí</button>
                        <div></div>
                        <button class="control-btn" onclick="quickMove('backward')" title="Backward">‚Üì</button>
                        <div></div>
                    </div>
                </div>

                <!-- Speed Control -->
                <div class="form-group">
                    <label for="speed-slider">Speed Control:</label>
                    <div class="slider-container">
                        <span>0%</span>
                        <input type="range" id="speed-slider" class="slider" min="0" max="100" value="50">
                        <span id="speed-value">50%</span>
                    </div>
                </div>

                <!-- Duration Control -->
                <div class="form-group">
                    <label for="duration-slider">Duration:</label>
                    <div class="slider-container">
                        <span>1s</span>
                        <input type="range" id="duration-slider" class="slider" min="1" max="10" value="2" step="0.5">
                        <span id="duration-value">2s</span>
                    </div>
                </div>

                <!-- Individual Motor Control -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Motor 1 (Left)</label>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-secondary" onclick="controlIndividualMotor(1, 'forward')" style="flex: 1; font-size: 12px;">‚Üë</button>
                            <button class="btn btn-secondary" onclick="controlIndividualMotor(1, 'backward')" style="flex: 1; font-size: 12px;">‚Üì</button>
                        </div>
                    </div>
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Motor 2 (Right)</label>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-secondary" onclick="controlIndividualMotor(2, 'forward')" style="flex: 1; font-size: 12px;">‚Üë</button>
                            <button class="btn btn-secondary" onclick="controlIndividualMotor(2, 'backward')" style="flex: 1; font-size: 12px;">‚Üì</button>
                        </div>
                    </div>
                </div>

                <!-- LED Quick Controls -->
                <div class="quick-controls">
                    <button class="btn btn-primary" onclick="quickLED('blink')">üí° Blink</button>
                    <button class="btn btn-primary" onclick="quickLED('sos')">üÜò SOS</button>
                    <button class="btn btn-primary" onclick="quickLED('party')">üéâ Party</button>
                </div>
            </div>
        </div>

        <!-- Status and Response Panel -->
        <div class="status-panel">
            <h2 class="card-title">üìä System Status & Response</h2>
            
            <div class="form-group">
                <label for="function-url">Azure Function Endpoint:</label>
                <input type="text" id="function-url" value="https://az-tutorial.azurewebsites.net/api/http_trigger_pi" placeholder="Enter your Azure Function URL">
            </div>

            <div class="form-group">
                <label>Response Log:</label>
                <div id="response" class="output">üîÑ Ready to receive commands...&#10;&#10;üí° Try some commands:&#10;‚Ä¢ "move forward at 50% speed for 2 seconds"&#10;‚Ä¢ "blink LED 3 times quickly"&#10;‚Ä¢ "turn left slowly"&#10;‚Ä¢ "send hello in morse code"</div>
            </div>
            
            <div class="form-group">
                <label>Debug Info (Last Request):</label>
                <div id="debug-info" class="debug-panel">No request sent yet...</div>
            </div>
            
            <div id="status" class="status" style="display: none;"></div>

            <div style="display: flex; gap: 15px; margin-top: 15px;">
                <button class="btn btn-secondary" onclick="clearLog()">üóëÔ∏è Clear Log</button>
                <button class="btn btn-secondary" onclick="testConnection()">üîó Test Connection</button>
                <button class="btn btn-primary" onclick="emergencyStop()">üõë Emergency Stop</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let isConnected = false;
        let currentSpeed = 50;
        let currentDuration = 2;

        // Initialize UI
        document.addEventListener('DOMContentLoaded', function() {
            updateSliderValues();
            addLogEntry('üöÄ Rover Control Interface Initialized', 'info');
        });

        // Update slider values display
        function updateSliderValues() {
            const speedSlider = document.getElementById('speed-slider');
            const durationSlider = document.getElementById('duration-slider');
            
            speedSlider.addEventListener('input', function() {
                currentSpeed = this.value;
                document.getElementById('speed-value').textContent = this.value + '%';
            });
            
            durationSlider.addEventListener('input', function() {
                currentDuration = this.value;
                document.getElementById('duration-value').textContent = this.value + 's';
            });
        }

        // Add log entry with timestamp
        function addLogEntry(message, type = 'info') {
            const responseDiv = document.getElementById('response');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            
            responseDiv.textContent += `\n[${timestamp}] ${icon} ${message}`;
            responseDiv.scrollTop = responseDiv.scrollHeight;
        }

        // Update debug info
        function updateDebugInfo(info) {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.textContent = JSON.stringify(info, null, 2);
        }

        // Set predefined prompts
        function setPrompt(text) {
            document.getElementById('user-prompt').value = text;
        }

        // Quick movement controls
        function quickMove(direction) {
            const commands = {
                'forward': `move forward at ${currentSpeed}% speed for ${currentDuration} seconds`,
                'backward': `move backward at ${currentSpeed}% speed for ${currentDuration} seconds`,
                'left': `turn left at ${currentSpeed}% speed for ${currentDuration} seconds`,
                'right': `turn right at ${currentSpeed}% speed for ${currentDuration} seconds`,
                'stop': 'stop all motors immediately'
            };
            
            if (commands[direction]) {
                document.getElementById('user-prompt').value = commands[direction];
                sendCommand();
            }
        }

        // Individual motor control
        function controlIndividualMotor(motorNum, direction) {
            const prompt = `motor ${motorNum} ${direction} at ${currentSpeed}% speed for ${currentDuration} seconds`;
            document.getElementById('user-prompt').value = prompt;
            sendCommand();
        }

        // Quick LED controls
        function quickLED(type) {
            const commands = {
                'blink': 'blink LED 5 times with 0.5 second intervals',
                'sos': 'send SOS in morse code',
                'party': 'blink LED in party rhythm pattern with fast beats'
            };
            
            if (commands[type]) {
                document.getElementById('user-prompt').value = commands[type];
                sendCommand();
            }
        }

        // Main send command function
        async function sendCommand() {
            const userPrompt = document.getElementById('user-prompt').value.trim();
            const functionUrl = document.getElementById('function-url').value.trim();
            
            if (!userPrompt) {
                showStatus('Please enter a command', 'error');
                return;
            }
            
            if (!functionUrl) {
                showStatus('Please enter Azure Function URL', 'error');
                return;
            }

            // Prepare the request payload - simplified format
            const requestPayload = {
                message: userPrompt
            };

            addLogEntry(`Sending command: "${userPrompt}"`, 'info');
            showStatus('üîÑ Sending command to rover...', 'warning');
            
            // Update debug info
            updateDebugInfo({
                url: functionUrl,
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: requestPayload
            });

            try {
                const response = await fetch(functionUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(requestPayload)
                });

                addLogEntry(`HTTP Status: ${response.status} ${response.statusText}`, response.ok ? 'info' : 'error');

                let responseText;
                try {
                    responseText = await response.text();
                    addLogEntry(`Raw Response: ${responseText}`, 'info');
                } catch (textError) {
                    responseText = `Error reading response: ${textError.message}`;
                    addLogEntry(responseText, 'error');
                }

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}\nResponse: ${responseText}`);
                }

                // Try to parse JSON response
                let parsedResponse;
                try {
                    parsedResponse = JSON.parse(responseText);
                    addLogEntry(`Parsed Response: ${JSON.stringify(parsedResponse, null, 2)}`, 'success');
                } catch (parseError) {
                    addLogEntry(`Response (not JSON): ${responseText}`, 'success');
                }

                showStatus('‚úÖ Command sent successfully!', 'success');
                updateConnectionStatus(true);
                
            } catch (error) {
                addLogEntry(`Error: ${error.message}`, 'error');
                showStatus(`‚ùå Failed to send command: ${error.message}`, 'error');
                updateConnectionStatus(false);
                
                // Update debug info with error details
                updateDebugInfo({
                    error: error.message,
                    url: functionUrl,
                    payload: requestPayload
                });
            }
        }

        // Test connection with a simple request
        async function testConnection() {
            const functionUrl = document.getElementById('function-url').value.trim();
            
            if (!functionUrl) {
                showStatus('Please enter Azure Function URL', 'error');
                return;
            }

            addLogEntry('Testing connection to Azure Function...', 'info');
            showStatus('üîó Testing connection...', 'warning');

            try {
                const testPayload = { message: "test connection" };
                
                updateDebugInfo({
                    test: true,
                    url: functionUrl,
                    payload: testPayload
                });

                const response = await fetch(functionUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(testPayload)
                });

                const responseText = await response.text();
                
                if (response.ok) {
                    addLogEntry(`Connection test successful! Status: ${response.status}`, 'success');
                    addLogEntry(`Test response: ${responseText}`, 'info');
                    showStatus('‚úÖ Connection test successful!', 'success');
                    updateConnectionStatus(true);
                } else {
                    throw new Error(`HTTP ${response.status}: ${responseText}`);
                }
                
            } catch (error) {
                addLogEntry(`Connection test failed: ${error.message}`, 'error');
                showStatus(`‚ùå Connection test failed: ${error.message}`, 'error');
                updateConnectionStatus(false);
            }
        }

        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }

        // Update connection status
        function updateConnectionStatus(connected) {
            isConnected = connected;
            const dot = document.getElementById('connection-dot');
            const text = document.getElementById('connection-text');
            
            if (connected) {
                dot.classList.add('connected');
                text.textContent = 'Connected to Rover';
            } else {
                dot.classList.remove('connected');
                text.textContent = 'Connection Status Unknown';
            }
        }

        // Utility functions
        function clearLog() {
            document.getElementById('response').textContent = 'üìã Log cleared...\n';
            document.getElementById('debug-info').textContent = 'Debug info cleared...';
        }

        function emergencyStop() {
            document.getElementById('user-prompt').value = 'emergency stop all motors and turn off LED';
            sendCommand();
            addLogEntry('üõë EMERGENCY STOP ACTIVATED', 'error');
        }

        // Event listeners
        document.getElementById('send-command').addEventListener('click', sendCommand);
        
        // Allow Enter key to send command
        document.getElementById('user-prompt').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                sendCommand();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.altKey) {
                switch(e.key) {
                    case 'w': quickMove('forward'); break;
                    case 's': quickMove('backward'); break;
                    case 'a': quickMove('left'); break;
                    case 'd': quickMove('right'); break;
                    case ' ': quickMove('stop'); e.preventDefault(); break;
                }
            }
        });
    </script>
</body>
</html>
